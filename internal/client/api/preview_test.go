package api_test

import (
	"bytes"
	"encoding/json"
	"testing"

	"github.com/ChiaYuChang/NewsSentimentAnalyzer/internal/client/api"
	"github.com/stretchr/testify/require"
)

func TestParseCache(t *testing.T) {
	data := []byte(`{\"query\":{\"user_id\":\"3e3eb7b4-f040-4656-8e65-adb85eff07b1\",\"salt\":\"\",\"api\":{\"key\":\"3c6d467e0257e37a3ad1fcaea6ad0054\",\"name\":\"GNews\",\"endpoint\":\"search\"},\"next_page\":2,\"raw_query\":\"country=tw&lang=zh&q=%E5%8F%B0%E5%8C%97\"},\"created_at\":\"2023-12-13T08:25:23.798943285Z\",\"news_item\":[{\"id\":\"01HHH4FPBRP2P5XS2F4CRCXBKM\",\"title\":\"陳珊妮化身暗黑教主年終開唱！用音樂《消災、除厄》徵求噩運，替大眾近身祈福\",\"link\":\"https://www.marieclaire.com.tw/entertainment/music/76588\",\"description\":\"陳珊妮日前在簡單生活節演出大受好評，隨即公布明年的專場資訊讓歌迷們聽個過癮，而於明年一月底分別在 Legacy 台北、台中舉辦「都市女聲」專場，並名為《消災、除厄》，要在農曆年前用音樂進行「年終掃除」，替聽眾粉絲將累積一整年的怨念與晦氣都消除！\",\"content\":\"[CLS][CLS]陳珊妮日前在簡單生活節演出大受好評，隨即公布明年的專場資訊讓歌迷們聽個過癮，而於明年一月底分別在 Legacy 台北、台中舉辦「都市女聲」專場，並名為《消災、除厄》，要在農曆年前用音樂進行「年終掃除」，替聽眾粉絲將累積一整年的怨念與晦氣都消除！by 豬編 - 2023/12/13 更新Photo／Legacy2024 陳珊妮內外全科《消災、除厄》演唱會將於 1/27在台北 Legacy Taipei、1/28 在台中 Legacy Taichung 舉辦。搶先曝光的《消災、除厄》演唱會主視... [663 chars]\",\"publication_date\":\"2023-12-12T16:53:50Z\"},{\"id\":\"01HHH4FPBRX42JQTW53WQDRXTZ\",\"title\":\"啞鈴弒父影帝也旁聽 母替子淚灑法庭求輕判12／15宣判\",\"link\":\"https://www.ettoday.net/news/20231212/2642078.htm\",\"description\":\"台北地院審理鍾姓男子啞鈴弒父案，因屬素人國民法官參審精障患者殺人全國首例，新科金馬影帝吳慷仁疑為新戲曾專程旁聽，本案檢辯雙方都認同鍾男行兇時的精神狀態具有減刑事由，但爭論犯罪動機究竟是「父子積怨」或「魔神仔附身」，全案歷經4天密集審理，今（12日）辯論終結，檢方求刑12年到16年並於刑前至少監護3年，律師主張應於刑前監護5年但求處8年徒刑，合議庭訂於本周五（15日）上午10點宣判。(啞鈴弒父,殺害直系血親尊親屬,暫行安置,監護處分)\",\"content\":\"[CLS][CLS]▲新北市鍾姓男子（淺色上衣）涉持啞鈴弒父，聲稱遭「魔神仔附身」。（資料照／記者劉昌松攝）記者黃哲民／台北報導台北地院審理鍾姓男子啞鈴弒父案，因屬素人國民法官參審精障患者殺人全國首例，新科金馬影帝吳慷仁疑為新戲曾專程旁聽，本案檢辯雙方都認同鍾男行兇時的精神狀態具有減刑事由，但爭論犯罪動機究竟是「父子積怨」或「魔神仔附身」，全案歷經4天密集審理，今（12日）辯論終結，檢方求刑12年到16年並於刑前至少監護3年，律師主張應於刑前監護5年但求處8年徒刑，合議庭訂於本周五（15日）上午10點宣判。[SEP]4... [1860 chars]\",\"publication_date\":\"2023-12-12T15:40:00Z\"},{\"id\":\"01HHH4FPBRYKE2HTGVV85RESKQ\",\"title\":\"旅義中國人揭北京專政 致帳戶被凍結父母被騷擾\",\"link\":\"https://www.cna.com.tw/news/acn/202312120382.aspx\",\"description\":\"旅居義大利的李穎是X平台（推特前身）帳號「李老師不是你老師」的本尊，因透過他帳號上傳的中共專政真相圖文當局容不下，以致他父母被騷擾、帳戶被凍結而飽受煎熬，甚至一年搬4次家。\",\"content\":\"[CLS][CLS]旅義中國人揭北京專政 致帳戶被凍結父母被騷擾請同意我們的隱私權規範，才能啟用聽新聞的功能。[SEP]請同意我們的隱私權規範，才能啟用聽新聞的功能。[SEP]（中央社台北12日電）旅居義大利的李穎是X平台（推特前身）帳號「李老師不是你老師」的本尊，因透過他帳號上傳的中共專政真相圖文當局容不下，以致他父母被騷擾、帳戶被凍結而飽受煎熬，甚至一年搬4次家。[SEP]不滿北京當局執行嚴封控的清零防疫措施，中國去年爆發號稱自六四以來最大規模的公民抗爭「白紙運動」。[SEP]紐約時報中文網今天報導，當時旅居義大利米蘭的李穎把自己推特（Tw... [954 chars]\",\"publication_date\":\"2023-12-12T14:48:00Z\"},{\"id\":\"01HHH4FPBRDNBYPSD1YYFBFM4R\",\"title\":\"「橘色惡魔」西門町踩街演出 圈粉3萬人次[影]\",\"link\":\"https://www.cna.com.tw/news/acul/202312120369.aspx\",\"description\":\"日本京都橘高校吹奏樂部今晚前進台北西門町踩街演出，行經知名地標如彩虹地景、西門紅樓，吸引3萬人次，光行前排練就吸引逾百人駐足觀賞，人潮多到有民眾直呼「好像跨年」。\",\"content\":\"[CLS][CLS]請同意我們的隱私權規範，才能啟用聽新聞的功能。[SEP]請同意我們的隱私權規範，才能啟用聽新聞的功能。[SEP]（中央社記者王寶兒台北12日電）日本京都橘高校吹奏樂部今晚前進台北西門町踩街演出，行經知名地標如彩虹地景、西門紅樓，吸引3萬人次，光行前排練就吸引逾百人駐足觀賞，人潮多到有民眾直呼「好像跨年」。[SEP]橘高校吹奏樂部又被稱為「橘色惡魔」，橘高校吹奏樂部顧問兼城裕今天向中央社記者表示，聽說西門町就像是日本原宿或澀谷的地方，這樣的熱鬧地方，團員跟觀眾的距離會很相近，「我覺得學生們來一定很高興。」「橘色惡魔」今... [448 chars]\",\"publication_date\":\"2023-12-12T14:02:00Z\"},{\"id\":\"01HHH4FPBR961SB488N4SHH76B\",\"title\":\"高雄新世紀福音戰士展VISUAL WORKS左營三越12/22盛大公開\",\"link\":\"https://www.4gamers.com.tw/news/detail/61577/eva-visual-works-2023-kaohsiung\",\"description\":\"廣受好評的【新世紀福音戰士展 VISUAL WORKS】將於 12 月 22 日移師至新光三越高雄左營店 10 樓展出，讓無法前來台北觀展的中、南部粉絲也能近距離欣賞、感受《新世紀福音戰士展》宏大世界觀的獨特魅力。\",\"content\":\"[CLS][CLS]2023年12月12日 星期二 下午6:51:22 [台北標準時間]餅乾廣受好評的【新世紀福音戰士展 VISUAL WORKS】將於 12 月 22 日移師至新光三越高雄左營店 10 樓展出，讓無法前來台北觀展的中、南部粉絲也能近距離欣賞、感受《新世紀福音戰士展》宏大世界觀的獨特魅力。[SEP]現場展示 1:1 「綾波零(暫稱)」等身大模型、初號機及長達 3 米的朗基努斯之槍模型，畫師手工繪製新劇場版的複製原畫更是特展獨具魅力的吸眼亮點。「神的房間」則是展出令粉絲讚嘆的使徒設定資料，被釘在十字架上莉... [591 chars]\",\"publication_date\":\"2023-12-12T10:51:22Z\"},{\"id\":\"01HHH4FPBRWBFTQ5PYACCHKP6V\",\"title\":\"〈台幣〉陷盤整收31.509元 靜待Fed利率決策\",\"link\":\"https://news.cnyes.com/news/id/5408105\",\"description\":\"主要亞幣今 (12) 日走勢不同調，日元展開反彈，新台幣兌美元匯率微升 0.3 分，終場收在 31.509 元，外資有買、有賣，態度轉趨保守，台北及元太外匯兩市成交值合計 17.37 億美元。\",\"content\":\"[CLS][CLS]主要亞幣今 (12) 日走勢不同調，日元展開反彈，新台幣兌美元匯率微升 0.3 分，終場收在 31.509 元，外資有買、有賣，態度轉趨保守，台北及元太外匯兩市成交值合計 17.37 億美元。市場靜待美國聯準會 (Fed) 本周的利率決策以及美國最新通膨數據。[SEP]新台幣兌美元今天以 31.49 元開盤，最高來到 31.45 元、最低 31.515 元，陷入盤整格局，台北外匯市場成交金額 11.56 億美元，元太外匯市場成交金額 5.81 億美元。[SEP]觀察主要貨幣今天對美元表現，根據央行臉書公布統計，... [333 chars]\",\"publication_date\":\"2023-12-12T10:46:45Z\"},{\"id\":\"01HHH4FPBR61H89Q157W73M2B3\",\"title\":\"〈渣打經濟展望〉估美明年降息2次共4碼 台灣及亞洲各央行不致立即跟進\",\"link\":\"https://news.cnyes.com/news/id/5408062\",\"description\":\"渣打銀行今 (12) 日舉辦 2024 經濟展望說明會，東北亞高級經濟分析師符銘財認為，美國不會再有進一步升息的動作，明年有望啟動降息，預估將有 2 次，共 4 碼 (100 個基點) 的空間\",\"content\":\"[CLS][CLS]渣打銀行今 (12) 日舉辦 2024 經濟展望說明會，東北亞高級經濟分析師符銘財認為，美國不會再有進一步升息的動作，明年下半年有望啟動降息，預估將有 2 次，共 4 碼 (100 個基點) 的空間，屆時台美利差將會縮短，而台灣及亞洲各央行應不至於立即跟進降息。[SEP]展望明年，符銘財指出，強勢美元時代應該已經結束了，美元指數 115 應該是一個波段高點，不過，美元相對其他幣別仍占有很大的優勢，若市場出現個別風險事件，當胃納量開始緊縮，以慣性來說，資金就回流到美元。[SEP]符銘財解釋，主要因美國資產負債表過... [527 chars]\",\"publication_date\":\"2023-12-12T10:01:01Z\"},{\"id\":\"01HHH4FPBRM6PKMQPNPC1VWJK3\",\"title\":\"北一女校慶颳橘色炫風橘高校同場演出 台日最強樂儀旗隊爭鋒[影]\",\"link\":\"https://www.cna.com.tw/news/acul/202312120097.aspx\",\"description\":\"今天是北一女中雙甲子校慶大會，找來在台灣颳起橘色旋風的日本橘高校吹奏樂部，與一女中樂儀旗隊交流演出，台日2強各自呈現最佳水準，讓校內各樓層擠滿人潮，並響起如雷掌聲。\",\"content\":\"[CLS][CLS]請同意我們的隱私權規範，才能啟用聽新聞的功能。[SEP]請同意我們的隱私權規範，才能啟用聽新聞的功能。[SEP]（中央社記者陳昱婷台北12日電）今天是北一女中雙甲子校慶大會，找來在台灣颳起橘色旋風的日本橘高校吹奏樂部，與一女中樂儀旗隊交流演出，台日2強各自呈現最佳水準，讓校內各樓層擠滿人潮，並響起如雷掌聲。[SEP]台北市立第一女子高中今天舉行創校120週年校慶大會，邀請「橘色惡魔」日本京都橘高校吹奏樂部共98人到場，與北一女樂儀旗隊同場演出，副總統賴清德也應邀出席。[SEP]兩隊在去年國慶後再度同台，不僅北一女學生駐足等候，... [550 chars]\",\"publication_date\":\"2023-12-12T04:25:00Z\"},{\"id\":\"01HHH4FPBRRJ6Q1BQ6R519NCDB\",\"title\":\"專論》計劃性炒作情緒！對課綱的攻擊 是統派的「狗哨政治」\",\"link\":\"https://newtalk.tw/news/view/2023-12-11/900092\",\"description\":\"北一女國文教師區桂枝最近的一個發言影片在網路上大量流傳，內容主要是控訴新課綱「刪掉」某篇古文，「以致於」大家都缺乏廉恥觀念，喪失倫常。從台灣主體認同的角度來看，可能會覺得區桂枝老師帶來非常「正面」且大量的討論，網路上一時之間大家都在批判過往的填鴨式古文教學，然而筆者認為這件事情帶來的影響還可以從主事\",\"content\":\"[CLS][CLS]北一女國文教師區桂枝最近的一個發言影片在網路上大量流傳，內容主要是控訴新課綱「刪掉」某篇古文，「以致於」大家都缺乏廉恥觀念，喪失倫常。從台灣主體認同的角度來看，可能會覺得區桂枝老師帶來非常「正面」且大量的討論，網路上一時之間大家都在批判過往的填鴨式古文教學，然而筆者認為這件事情帶來的影響還可以從主事者（大中華立場非常鮮明的「歷史教育新三自運動協會」）的角度來看，其目的就是要炒作認同的議題，並且（很成功地）凝聚親中派和統派民眾的情感。[SEP]文言文爭議是「中華道統」對多元文化的反撲 也是認同爭議這次區... [2417 chars]\",\"publication_date\":\"2023-12-11T02:44:13Z\"},{\"id\":\"01HHH4FPBRZPPGPGVRQQ3CJ5VW\",\"title\":\"內外資鬥法！聯電、遠東新、台泥、世界這4檔要小心\",\"link\":\"https://ec.ltn.com.tw/article/breakingnews/4516420\",\"description\":\"〔記者張慧雯／台北報導〕上週投信買超台股54.25億元，外資賣超54.5億元，年底將近、內外資鬥法，從統計看來烽火集中於聯電（2303）、遠東新（1402）、台泥（1101）、世界（5347），\",\"content\":\"[CLS][CLS]內外資鬥法!聯電、遠東新、台泥、世界這4檔要小心。（擷取自奇摩股市）〔記者張慧雯／台北報導〕上週投信買超台股54.25億元，外資賣超54.5億元，年底將近、內外資鬥法，從統計看來烽火集中於聯電（2303）、遠東新（1402）、台泥（1101）、世界（5347），投資人進場可得多小心。[SEP]上週三大法人僅有投信站在買方，買超54.25億元，外資與自營商雙雙調節，分別賣超54.5億元、196.28億元，三大法人合計賣超196.54億元。[SEP]請繼續往下閱讀...投信週買超排行榜中，聯電排名第一，買超張數... [416 chars]\",\"publication_date\":\"2023-12-10T12:04:42Z\"}],\"selected_all\":false,\"selected_nid\":[\"01HHH4FPBRDNBYPSD1YYFBFM4R\",\"01HHH4FPBRM6PKMQPNPC1VWJK3\",\"01HHH4FPBRP2P5XS2F4CRCXBKM\"],\"analyzer_options\":{\"api\":\"cohere\",\"id\":6,\"embedding-options\":{\"embedding\":true,\"input_type\":\"search_document\",\"embedding_model\":\"embed-english-v3.0\"},\"sentiment-analysis-options\":{\"sentiment\":true,\"max_tokens\":0,\"truncate\":\"END\"}}}`)

	data = bytes.ReplaceAll(data, []byte(`\"`), []byte(`"`))

	var s api.PreviewCache
	err := json.Unmarshal(data, &s)
	require.NoError(t, err)

	t.Log(s)
}
